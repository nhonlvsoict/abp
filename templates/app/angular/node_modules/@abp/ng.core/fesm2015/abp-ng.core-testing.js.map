{"version":3,"file":"abp-ng.core-testing.js","sources":["../../../packages/core/testing/src/lib/services/mock-permission.service.ts","../../../packages/core/testing/src/lib/services/mock-rest.service.ts","../../../packages/core/testing/src/lib/core-testing.module.ts","../../../packages/core/testing/src/lib/utils/clear-page.util.ts","../../../packages/core/testing/src/lib/utils/wait.util.ts","../../../packages/core/testing/src/abp-ng.core-testing.ts"],"sourcesContent":["import { ConfigStateService, PermissionService } from '@abp/ng.core';\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class MockPermissionService extends PermissionService {\n  constructor(protected configState: ConfigStateService) {\n    super(configState);\n    this.grantAllPolicies();\n  }\n\n  grantAllPolicies() {\n    const grantedPolicies = new Proxy(\n      {},\n      {\n        get() {\n          return true;\n        },\n      },\n    );\n\n    this.configState['store'].deepPatch({ auth: { grantedPolicies } });\n  }\n\n  grantPolicies(keys: string[]) {\n    const grantedPolicies = keys.reduce((policies, key) => {\n      policies[key] = true;\n      return policies;\n    }, {});\n\n    this.configState['store'].deepPatch({ auth: { grantedPolicies } });\n  }\n}\n","import { ABP, CORE_OPTIONS, EnvironmentService, RestService } from '@abp/ng.core';\nimport { HttpClient } from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\nimport { Observable, throwError } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class MockRestService extends RestService {\n  constructor(\n    @Inject(CORE_OPTIONS) protected options: ABP.Root,\n    protected http: HttpClient,\n    protected environment: EnvironmentService,\n  ) {\n    super(options, http, environment, null);\n  }\n\n  handleError(err: any): Observable<any> {\n    return throwError(err);\n  }\n}\n","import {\n  ABP,\n  BaseCoreModule,\n  coreOptionsFactory,\n  CORE_OPTIONS,\n  LIST_QUERY_DEBOUNCE_TIME,\n  LOADER_DELAY,\n  PermissionService,\n  RestService,\n} from '@abp/ng.core';\nimport { APP_BASE_HREF } from '@angular/common';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\nimport { NoopAnimationsModule } from '@angular/platform-browser/animations';\nimport { provideRoutes } from '@angular/router';\nimport { RouterTestingModule } from '@angular/router/testing';\nimport { MockPermissionService } from './services/mock-permission.service';\nimport { MockRestService } from './services/mock-rest.service';\n\n/**\n * CoreTestingModule is the module that will be used in tests\n * and it provides mock alternatives\n */\n@NgModule({\n  exports: [RouterTestingModule, BaseCoreModule],\n  imports: [NoopAnimationsModule, RouterTestingModule, BaseCoreModule],\n})\nexport class CoreTestingModule {\n  static withConfig(\n    { baseHref = '/', listQueryDebounceTime = 0, routes = [], ...options } = {} as ABP.Test,\n  ): ModuleWithProviders<CoreTestingModule> {\n    return {\n      ngModule: CoreTestingModule,\n      providers: [\n        { provide: APP_BASE_HREF, useValue: baseHref },\n        {\n          provide: 'CORE_OPTIONS',\n          useValue: {\n            skipGetAppConfiguration: true,\n            ...options,\n          },\n        },\n        {\n          provide: CORE_OPTIONS,\n          useFactory: coreOptionsFactory,\n          deps: ['CORE_OPTIONS'],\n        },\n        {\n          provide: LIST_QUERY_DEBOUNCE_TIME,\n          useValue: listQueryDebounceTime,\n        },\n        {\n          provide: PermissionService,\n          useClass: MockPermissionService,\n        },\n        {\n          provide: RestService,\n          useClass: MockRestService,\n        },\n        {\n          provide: LOADER_DELAY,\n          useValue: 0,\n        },\n        provideRoutes(routes),\n      ],\n    };\n  }\n}\n","import { ComponentFixture } from '@angular/core/testing';\n\nexport function clearPage<T extends any>(_fixture: ComponentFixture<T>) {\n  if (!document) return;\n\n  const elements = document.querySelectorAll('body > *');\n  elements.forEach(element => {\n    if (/^(abp|ngb)-/i.test(element.tagName)) document.body.removeChild(element);\n  });\n}\n","import { ComponentFixture } from '@angular/core/testing';\n\nexport function wait<T extends any>(fixture: ComponentFixture<T>, timeout = 0) {\n  fixture.detectChanges();\n  return new Promise(res => setTimeout(res, timeout));\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {MockPermissionService as ɵa} from './lib/services/mock-permission.service';\nexport {MockRestService as ɵb} from './lib/services/mock-rest.service';"],"names":[],"mappings":"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"}